# project_1

Simple node.js portfolio app.

## TODO

- [x] Mail agent data load (uses *config* package)
- [x] MongoDB integration
- [ ] SSL certificate for NGINX
- [ ] Partials README
- [ ] Create nice images for errors

## Run it

*Requires running mongod*

From *src* dir:

- *./mongo_init.sh*
- *npm install*
- Manually update *bin/config/default.json* 
- *npm start*


## NGINX

This app uses NGINX as reverse proxy with rate limiter. In a future version SSL certificate will be integrated to allow HTTPS connections. [Config file](doc/nginx_config)

## Node

The server uses Express with ejs rendering. To make it simpler it also uses ejs-mate to divide template in sub-parts.

## Template

The template is based on [this example](https://www.w3schools.com/bootstrap/bootstrap_theme_company.asp), as said it was rewrote in EJS. The page is divided in multiple partials, each one has an associated JSON structure to allow easy modifications.

## Customisation

TODO: write a nice [README](doc/README.md) to illustrate partial templates.

### MongoDB

For now, this site uses a basic data structure: each page on the site is stored in a mongo database with the associated route. On request it render the asked page if it exists. 

**mongo_init.sh** import json files from *src/data/json* to the DB. Subdirectory name is used as collection name.

This app uses [config](https://www.npmjs.com/package/config) package to set the used DB (as well as the mail agent).

### Page structure

Each page is structured like this.

``` none
psge
|-- lang
|-- route
|-- head
|     |-- title
|     |-- stylesheets   []
|     `-- javascripts   []
`-- body
      |-- header
      |-- content       []
      `-- footer
```

The JSON files contain the all the data required to generate pages.

- **Lang:** Language (possible evolution for multiple language support)

- **Route:** Each JSON file generates a page, the route attribute makes routing easier (as I write these lines, routes are hardcoded ad Express midlewares, this will be improves in the future)

- **Head:** Data required in the \<head\>.

- **Body:** Header and footer are unique, everything in between is a list of elements. Each element is associated to a EJS partial and is stored in the *content* list.

#### *Content* and EJS partials

Each element is structured like this:

``` none
element/footer
|
|-- file
|-- visible
|-- listedInNavbar
|-- id
|-- navBarTitle
`-- data          []
```

- **file:** String, reference to the EJS partial template

- **visible:** Boolean, if false this element isn't generated by EJS.

- **listedInNavbar:** Boolean, if false false this element isn't listed in navbar.

- **id:** String, just HTML *id* for navbar.

- **navBarTitle:** String, element name in navbar.

- **data:** : Object, date relative to the EJS template. The internal structure is dependant on the EJS file.

Footers have the same structure.

Headers have a different structure:

``` none
header
|
|-- file
|-- visible
`-- data          []
```

Header id is always *top* and is hardcoded in EJS templates.

## Mail agent

I wanted the user to contact me as easily as possible, without enter any passwords. After the form is submitted, node.js uses a dedicated Email address do send me all the form data directly at my personal email. Mail addresses and pw are stored in the config file. 
